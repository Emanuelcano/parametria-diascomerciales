<?php
defined('BASEPATH') OR exit('No direct script access allowed');
require_once APPPATH . 'third_party/REST_Controller.php';
require_once APPPATH . 'third_party/Format.php';
use Restserver\Libraries\REST_Controller;

class ApiReferencias extends REST_Controller
{
    protected $_solicitud;

    public function __construct()
    {
        
        parent::__construct();
        $this->load->library('User_library');
        $auth = $this->user_library->check_token();

        if($auth->status == parent::HTTP_OK)
        {
            // MODELS
            $this->load->model('Cliente_model','cliente',TRUE);
            // LIBRARIES
        }else{
            $this->session->sess_destroy();
            $this->response(['redirect'=>base_url('login')],$auth->status);
        }
    }
    /**
     * Metodo para ajustar maestro.agenda_telefonica
     * con las maestro.referencias
     */
    public function migrarTelefonosReferencias_post($id_cliente = null){

       if($id_cliente === null){
			/*$id_cliente = explode(',', "12919,12977,13072,13208,13213,13453,13454,13490,13547,13660,13698,13729,13759,13777,13793,13824,13829,13845,13859,13877,13898,13900,13904,13918,13931,13950,13954,13976,14010,14051,14062,14079,14080,14083,14088,14118,14139,14174,14180,14185,14196,14205,14258,14277,14281,14308,14342,14351,14356,14368,14402,14434,14456,14478,14487,14496,14530,14537,14538,14548,14555,14557,14560,14564,14586,14618,14620,14650,14664,14675,14688,14691,14695,14700,14788,14822,14858,14925,14966,14991,15004,15005,15009,15014,15031,15048,15082,15088,15108,15113,15128,15138,15139,15174,15176,15202,15220,15237,15256,15277,15279,15343,15355,15362,15365,15395,15408,15428,15512,15524,15533,15543,15563,15585,15595,15597,15615,15619,15645,15656,15659,15695,15703,15716,15721,15734,15753,15758,15790,15831,15834,15841,15842,15863,15875,15935,15960,16022,16026,16077,16130,16204,16231,16280,16311,16347,16382,16428,16432,16443,16446,16461,16488,16498,16499,16513,16517,16540,16541,16554,16564,16585,16586,16641,16717,16740,16745,16793,16839,16846,16864,16908,16935,16950,16967,17012,17014,17017,17034,17042,17059,17064,17082,17092,17094,17121,17148,17160,17173,17174,17175,17214,17231,17260,17264,17266,17287,17319,17326,17335,17359,17370,17414,17431,17468,17474,17482,17485,17486,17544,17573,17620,17634,17637,17650,17722,17764,17804,17838,17843,17845,17871,17872,17887,17913,17949,17972,17973,17978,17987,17992,18014,18113,18122,18124,18160,18175,18192,18195,18258,18267,18268,18274,18333,18349,18353,18368,18381,18395,18400,18401,18411,18422,18428,18454,18457,18471,18474,18522,18542,18550,18605,18613,18614,18615,18616,18658,18661,18662,18693,18703,18713,18755,18781,18805,18828,18837,18847,18855,18864,18877,18881,18890,18894,18898,18899,18900,18908,18909,18912,18928,18962,18964,18984,18995,19009,19018,19020,19028,19029,19047,19049,19050,19051,19056,19065,19070,19076,19127,19132,19135,19139,19160,19169,19179,19186,19194,19211,19225,19239,19246,19259,19261,19268,19270,19275,19291,19296,19318,19356,19362,19377,19388,19417,19422,19457,19462,19465,19474,19495,19505,19524,19528,19623,19629,19652,19664,19665,19706,19739,19750,19909,20021,20026,20357,20386,20505,20513,20530,20539,20552,20613,20641,20865,21029,21076,21092,21208,21695,22572");*/
			var_dump("ingresa un id cliente.");die;
       }
        

        $referencias = $this->cliente->get_referencia_aux($id_cliente);

        foreach ($referencias as $key => $refs) {
        	# code...
        	$where = ['id_cliente' => $refs['id_cliente'], 'numero'=> $refs['telefono'], 'fuente' => 'REFERENCIA'];
        	$agenda_tel = $this->cliente->get_agenda_telefonica($where);
        	if(empty($agenda_tel)){

        		$dataAgendaTelefonica = array(
                    'id_cliente' => $refs['id_cliente'],
                    'numero' => $refs['telefono'],
                    'tipo' => 1,
                    'fuente' => 3,
                    'contacto'=>$refs['nombres_apellidos'],
                    'estado' => 1
                );
				$dataAgendaTelefonica['id_parentesco'] = ($refs['id_parentesco'] !== null ) ? $refs['id_parentesco'] : "";
                $result = $this->cliente->agregar_telefono($dataAgendaTelefonica);

                if($result > 0){
                	print_r($dataAgendaTelefonica);
                }
        	}
        }
    }

  

}